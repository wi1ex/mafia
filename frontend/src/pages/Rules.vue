<template>
  <main class="rules">
    <div class="rules-layout">
      <div class="rules-content">
        <section id="intro" class="hero">
          <div class="hero-content">
            <p class="eyebrow">deceit.games</p>
            <h1>Правила сообщества</h1>
            <p class="lead">
              Использование платформы deceit.games означает согласие с настоящими Правилами и связанными документами.
            </p>
            <div class="tags">
              <span class="pill">14+</span>
              <span class="pill">Приватность</span>
              <span class="pill">Санкции</span>
            </div>
            <div class="meta">
              <div class="meta-item">
                <span class="label">Возраст</span>
                <span class="value">14+</span>
              </div>
              <div class="meta-item">
                <span class="label">Санкции</span>
                <span class="value">SUSPEND / TIMEOUT / BAN</span>
              </div>
            </div>
          </div>
        </section>

        <section id="sanctions" class="notice">
          <div class="notice-text">
            <h2>Нотация санкций</h2>
            <p>
              Порядок применения санкций: конкретный вид санкции, срок и дополнительные меры (например, удаление контента,
              требование сменить ник/аватар/название комнаты, ограничения функций) определяются Администрацией с учётом
              характера нарушения, повторяемости, последствий и иных обстоятельств.
            </p>
          </div>
          <div class="notice-list">
            <div class="notice-item">(SUSPEND) — временное отстранение от участия в играх.</div>
            <div class="notice-item">(TIMEOUT) — временное ограничение доступа к комнатам.</div>
            <div class="notice-item">(BAN) — постоянная блокировка доступа к платформе.</div>
          </div>
        </section>

        <section class="rules-grid">
          <article id="section-1" class="rule-card">
            <h3>1. Принятие правил, авторизация и изменения</h3>
            <ul>
              <li>1.1. Использование платформы deceit.games означает согласие с настоящими Правилами и связанными документами (Политика приватности, Правила контента, Регламент санкций, правила отдельных режимов/комнат).</li>
              <li>1.2. Администрация вправе изменять Правила. Новая редакция публикуется на сайте и применяется с даты публикации (или иной указанной даты). Продолжение использования платформы означает согласие с изменениями.</li>
              <li>1.3. Авторизация через Telegram. Для входа/регистрации пользователь использует Telegram. Авторизация возможна только при передаче платформе данных Telegram, необходимых для идентификации и работы аккаунта.</li>
              <li>1.4. Согласие на обработку данных. При авторизации через Telegram пользователь соглашается на обработку данных, получаемых от Telegram и/или предоставляемых пользователем, включая: Telegram ID, никнейм/username (если имеется), аватар (фото профиля).</li>
              <li>1.5. Отзыв согласия. Пользователь может отозвать согласие на обработку данных, удалив свой аккаунт в Личном кабинете.</li>
              <li>1.6. О привязке санкций к Telegram-аккаунту. Аккаунт на платформе привязан к Telegram-аккаунту пользователя (в первую очередь — к Telegram ID). При применении санкций доступ к платформе может быть ограничен/заблокирован именно для аккаунта, авторизованного через соответствующий Telegram-аккаунт.</li>
            </ul>
            <p class="note">Примечание: платформа не “блокирует” Telegram-аккаунт в самом Telegram; блокируется доступ внутри deceit.games для пользователя, вошедшего через данный Telegram ID.</p>
          </article>

          <article id="section-2" class="rule-card">
            <h3>2. Возраст и допустимость использования</h3>
            <ul>
              <li>2.1. Платформа предназначена для пользователей не младше 14 лет. При выявлении нарушения возрастного ограничения доступ может быть запрещён.</li>
              <li>2.2. Если на платформе возможны видео/аудио-трансляции, пользователь подтверждает, что осознаёт риски публичного общения и обязуется соблюдать ограничения по контенту (включая 18+). Нарушение ограничений по контенту наказывается по соответствующим пунктам Раздела 4.</li>
              <li>2.3. Несовершеннолетним запрещено публиковать/передавать персональные данные и контент, если это нарушает применимое законодательство или настоящие Правила.</li>
            </ul>
          </article>

          <article id="section-3" class="rule-card">
            <h3>3. Аккаунт, безопасность и добросовестность</h3>
            <ul>
              <li>3.1. Запрещено передавать доступ к своему аккаунту третьим лицам.</li>
              <li>3.2. Запрещён мультиаккаунтинг и обход санкций (вход под другим аккаунтом/устройством/идентификатором для избегания наказания).</li>
              <li>3.3. Запрещена выдача себя за другое лицо, за администрацию платформы или за ведущего/судью в игровых комнатах, а также фальсификация статуса или полномочий.</li>
              <li>3.4. При подозрении на компрометацию аккаунта пользователь обязан уведомить администрацию.</li>
            </ul>
          </article>

          <article id="section-4" class="rule-card">
            <h3>4. Общие правила общения, контента и поведения</h3>
            <h4>4.1. Уважение и запрет токсичности</h4>
            <ul>
              <li>4.1.1. Запрещены оскорбления, унижение, травля, клевета, жесткий троллинг, провокации, шантаж, угрозы, «минус глаза/минус уши».</li>
              <li>4.1.2. Запрещены пожелания смерти/болезни, призывы к самоубийству/самоповреждению, подстрекательство.</li>
              <li>4.1.3. Запрещена дискриминация/разжигание ненависти по полу, гендеру, расе, национальности, языку, возрасту, инвалидности, религии, политическим взглядам и др.</li>
            </ul>
            <h4>4.2. Приватность и личная жизнь</h4>
            <ul>
              <li>4.2.1. Запрещён доксинг: публикация/угрозы публикации персональных данных без согласия (адреса, телефоны, документы, банковские сведения, переписки и т.п.).</li>
              <li>4.2.2. Запрещены попытки выманивания персональных данных и доступов (социнженерия), фишинг, скам.</li>
              <li>4.2.3. Запрещено преследование (harassment), навязчивые контакты, сексуальные домогательства.</li>
            </ul>
            <h4>4.3. Запрещённый контент</h4>
            <ul>
              <li>4.3.1. Запрещены порнография, сексуальный контент с участием/образом несовершеннолетних (в т.ч. имитации), контент сексуальной эксплуатации.</li>
              <li>4.3.2. Запрещён шок-контент (жестокость, расчленёнка и т.п.), демонстрация насилия ради эффекта.</li>
              <li>4.3.3. Запрещена пропаганда/сбыт/инструкции по наркотикам и запрещённым веществам.</li>
              <li>4.3.4. Запрещены призывы к насилию/экстремизму, символика и пропаганда запрещённых организаций.</li>
            </ul>
            <h4>4.4. Спам и злоупотребления коммуникацией</h4>
            <ul>
              <li>4.4.1. Запрещён спам, флуд, массовые однотипные сообщения, навязчивая реклама.</li>
              <li>4.4.2. Запрещены бессмысленные жалобы и злоупотребление обращениями к модерации.</li>
            </ul>
            <h4>4.5. Никнеймы, аватары и названия комнат</h4>
            <ul>
              <li>4.5.1. Запрещены никнеймы/аватары/названия комнат/описания, содержащие: мат и грубую вульгарность; оскорбления; дискриминацию/хейт; экстремизм; порнографию; призывы к насилию; рекламу/донат-ссылки без согласования; вводящие в заблуждение обозначения (в т.ч. «модератор», «админ», имитация служебных статусов), а также выдача себя за другого человека.</li>
              <li>4.5.2. Администрация вправе потребовать изменить никнейм/аватар/название комнаты/описание или удалить контент. Отказ выполнить требование рассматривается как нарушение.</li>
            </ul>
          </article>

          <article id="section-5" class="rule-card">
            <h3>5. Камера/микрофон, участие в комнате, запись</h3>
            <ul>
              <li>5.1. Запрещено умышленно создавать помехи участию в комнате (постоянные выключения, демонстративное «затыкание ушей», намеренное скрытие лица при обязательной камере и т.п.), если режим комнаты требует видимость/слышимость.</li>
              <li>5.2. Пользователь понимает, что другие участники могут вести запись экрана/звука для доказательства нарушений, если это не запрещено законом. Администрация может запрашивать такие доказательства при рассмотрении жалоб.</li>
            </ul>
          </article>

          <article id="section-6" class="rule-card">
            <h3>6. Честность, реклама, безопасность</h3>
            <ul>
              <li>6.1. Запрещены попытки взлома, эксплуатация уязвимостей, DDoS/«дудос паузой», вмешательство в сетевое взаимодействие, обход ограничений.</li>
              <li>6.2. Запрещено использование ботов/скриптов/автоматизации без разрешения.</li>
              <li>6.3. Запрещено целенаправленно препятствовать развитию платформы, дискредитировать администрацию через ложные обвинения, подделывать доказательства.</li>
              <li>6.4. Запрещена подделка скриншотов/логов/видео и иных материалов с целью наказания других пользователей.</li>
              <li>6.5. Запрещена реклама, публикация ссылок на донат/платёжные страницы, сбор средств без согласования с администрацией.</li>
            </ul>
          </article>

          <article id="section-7" class="rule-card">
            <h3>7. Жалобы, доказательства, модерация и апелляции</h3>
            <ul>
              <li>7.1. В игровых комнатах нарушения в рамках игры фиксирует ведущий/судья; также пользователь может подать жалобу в администрацию.</li>
              <li>7.2. Жалобы по оскорблениям/личным конфликтам могут приниматься от пострадавшей стороны; нарушения приватности/мошенничества/безопасности/запрещённого контента рассматриваются по обращению любого пользователя или по инициативе администрации.</li>
              <li>7.3. Допустимые доказательства: записи экрана, скриншоты, логи комнаты, системные события.</li>
              <li>7.4. Администрация вправе удалять контент, ограничивать доступ к функциям, блокировать комнаты/аккаунты и применять санкции по настоящим Правилам.</li>
              <li>7.5. Апелляции: пользователь вправе подать апелляцию в течение 3 дней, приложив аргументы и доказательства. Решение принимает администрация; повторные апелляции по тем же фактам могут быть отклонены.</li>
            </ul>
          </article>
        </section>

        <section id="mafia-rules" class="footer-card">
          <div class="footer-text">
            <h2>Игровые правила «Мафия»</h2>
            <ul>
              <li>8.1. Запрещены подсказки извне, переписка с третьими лицами по игре, просмотр стрима игры, находясь в игре, «слив роли».</li>
              <li>8.2. Запрещено преднамеренное «вскрытие роли» другим игрокам любыми способами.</li>
              <li>8.3. Запрещено влияние на игру через сообщения/статусы «со стороны», скрины, откаты и т.п.</li>
              <li>8.4. Запрещены клятвы/пари/шантаж/подкуп для влияния на голосование или «доказательства роли».</li>
              <li>8.5. Запрещено озвучивать речевую информацию на языке, который очевидно скрывает смысл от ведущего/судьи или большинства игроков. (внутриигровые меры комнаты)</li>
              <li>8.6. После решающего убийства/голосования, определившего результат игры, меры, связанные с игровым преимуществом, как правило, не применяются, если нарушение уже не могло повлиять на исход (кроме грубых нарушений поведения/безопасности, которые могут наказываться всегда).</li>
              <li>8.7. Ведущему запрещено злоупотреблять правами, требовать оплату за проведение игр (если владелец комнаты это запрещает), применять меры из личной выгоды.</li>
              <li>8.8. Ведущему запрещено раскрывать роли до окончания игры; запрещено подсказывать/комментировать так, что это даёт игровую информацию.</li>
            </ul>
          </div>
          <div class="footer-meta">
            <div class="meta-item">
              <span class="label">Применение</span>
              <span class="value">Эти правила действуют только внутри игровых комнат мафии и дополняют Правила сайта.</span>
            </div>
          </div>
        </section>
      </div>

      <aside class="rules-toc" aria-label="Содержание страницы">
        <div class="toc-card">
          <span class="toc-title">Содержание</span>
          <nav class="toc-links">
            <a v-for="item in tocLinks" :key="item.id" :href="`#${item.id}`" :class="{ active: activeId === item.id }"
               :aria-current="activeId === item.id ? 'location' : undefined" @click="onTocClick($event, item.id)">
              {{ item.label }}
            </a>
          </nav>
        </div>
      </aside>
    </div>
  </main>
</template>

<script setup lang="ts">
import { onMounted, onBeforeUnmount, ref } from 'vue'

type TocItem = {
  id: string
  label: string
}

const tocLinks: TocItem[] = [
  { id: 'intro', label: 'Введение' },
  { id: 'sanctions', label: 'Нотация санкций' },
  { id: 'section-1', label: '1. Принятие правил, авторизация и изменения' },
  { id: 'section-2', label: '2. Возраст и допустимость использования' },
  { id: 'section-3', label: '3. Аккаунт, безопасность и добросовестность' },
  { id: 'section-4', label: '4. Общие правила общения, контента и поведения' },
  { id: 'section-5', label: '5. Камера/микрофон, участие в комнате, запись' },
  { id: 'section-6', label: '6. Честность, реклама, безопасность' },
  { id: 'section-7', label: '7. Жалобы, доказательства, модерация и апелляции' },
  { id: 'mafia-rules', label: '8. Игровые правила «Мафия»' },
]

const activeId = ref(tocLinks[0]?.id ?? '')
let observer: IntersectionObserver | null = null

function setActive(id: string) {
  if (id && activeId.value !== id) activeId.value = id
}

function onTocClick(event: MouseEvent, id: string) {
  if (event.defaultPrevented || event.button !== 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return
  const el = document.getElementById(id)
  if (!el) return
  event.preventDefault()
  setActive(id)
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches
  el.scrollIntoView({ behavior: prefersReduced ? 'auto' : 'smooth', block: 'start' })
  history.replaceState(null, '', `#${id}`)
}

function observeSections() {
  const targets = tocLinks.map(item => document.getElementById(item.id)).filter((el): el is HTMLElement => Boolean(el))
  if (!targets.length) return

  observer = new IntersectionObserver((entries) => {
    const visible = entries.filter(entry => entry.isIntersecting)
    if (!visible.length) return
    visible.sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)
    const top = visible[0].target as HTMLElement
    setActive(top.id)
  }, {
    rootMargin: '-30% 0px -60% 0px',
    threshold: 0,
  })

  targets.forEach(el => observer?.observe(el))
}

onMounted(() => {
  observeSections()
  const hash = window.location.hash.replace('#', '')
  if (hash && tocLinks.some(item => item.id === hash)) {
    const el = document.getElementById(hash)
    if (el) {
      el.scrollIntoView({ behavior: 'auto', block: 'start' })
      setActive(hash)
    }
  }
})

onBeforeUnmount(() => {
  observer?.disconnect()
  observer = null
})
</script>

<style scoped lang="scss">
.rules {
  width: 60%;
  margin: 20px auto;
  line-height: 1.5;
  overflow: auto;
  scrollbar-width: none;
  [id] {
    scroll-margin-top: 90px;
  }
  .rules-layout {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 300px;
    gap: 20px;
    align-items: start;
  }
  .rules-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 0;
  }
  .rules-toc {
    position: sticky;
    top: 0;
    align-self: start;
    .toc-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 16px;
      border-radius: 10px;
      background-color: $graphite;
      border: 1px solid $grey;
      box-shadow: 0 12px 24px rgba($black, 0.25);
    }
    .toc-title {
      font-size: 12px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: $ashy;
    }
    .toc-links {
      display: flex;
      flex-direction: column;
      gap: 6px;
      a {
        padding: 5px 15px;
        border-radius: 5px;
        border: 1px solid transparent;
        background-color: $dark;
        color: $fg;
        font-size: 14px;
        text-decoration: none;
        transition: background-color 0.25s ease-in-out, border-color 0.25s ease-in-out, color 0.25s ease-in-out;
        &:hover {
          background-color: $lead;
          border-color: $grey;
          color: $white;
        }
        &.active {
          background-color: $lead;
          border-color: $orange;
          color: $white;
          box-shadow: inset 8px 0 0 $orange;
        }
      }
    }
  }
  .hero {
    position: relative;
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: 20px;
    padding: 24px;
    border-radius: 12px;
    background: linear-gradient(to right, $lead, $dark);
    border: 1px solid $grey;
    box-shadow: 0 18px 35px rgba($black, 0.25);
    overflow: hidden;
    animation: liftIn 0.25s ease-out both;
    &::before,
    &::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      filter: blur(0);
      opacity: 0.5;
    }
    &::before {
      width: 320px;
      height: 320px;
      top: -160px;
      left: -120px;
      background: radial-gradient(circle, $orange, transparent 50%);
    }
    &::after {
      width: 400px;
      height: 400px;
      bottom: -200px;
      right: -130px;
      background: radial-gradient(circle, $green, transparent 50%);
    }
    .hero-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      .eyebrow {
        margin: 0;
        font-size: 12px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: $ashy;
      }
      h1 {
        margin: 0;
        font-size: 35px;
        letter-spacing: 1px;
      }
      .lead {
        margin: 0;
        color: $fg;
        max-width: 550px;
      }
      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        .pill {
          padding: 4px 12px;
          border-radius: 50px;
          border: 1px solid $grey;
          background-color: $dark;
          font-size: 12px;
          letter-spacing: 1px;
          text-transform: uppercase;
        }
      }
      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px 16px;
        .meta-item {
          display: flex;
          flex-direction: column;
          gap: 4px;
          padding: 8px 10px;
          border-radius: 8px;
          background-color: $graphite;
          border: 1px solid $grey;
          min-width: 100px;
          .label {
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: $ashy;
          }
          .value {
            font-size: 14px;
            color: $fg;
          }
        }
      }
    }
  }
  .rules-grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 16px;
    .rule-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 18px;
      border-radius: 10px;
      background-color: $graphite;
      border: 1px solid $grey;
      box-shadow: 0 10px 22px rgba($black, 0.25);
      animation: liftIn 0.25s ease-out both;
      h3 {
        margin: 0;
        font-size: 18px;
        color: $fg;
      }
      h4 {
        margin: 6px 0 0;
        font-size: 15px;
        color: $fg;
      }
      p {
        margin: 0;
        color: $ashy;
      }
      p.note {
        margin-top: 6px;
      }
      ul {
        margin: 0;
        padding-left: 18px;
        display: grid;
        gap: 6px;
        li {
          color: $fg;
        }
      }
      &:nth-child(2) { animation-delay: 0.15s; }
      &:nth-child(3) { animation-delay: 0.25s; }
      &:nth-child(4) { animation-delay: 0.15s; }
      &:nth-child(5) { animation-delay: 0.25s; }
      &:nth-child(6) { animation-delay: 0.15s; }
    }
  }
  .notice {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 18px;
    padding: 20px;
    border-radius: 12px;
    background: linear-gradient(to right, $graphite, $lead);
    border: 1px solid $orange;
    box-shadow: 0 16px 30px rgba($black, 0.25);
    animation: liftIn 0.25s ease-out both;
    .notice-text {
      h2 {
        margin: 0 0 8px;
        font-size: 20px;
      }
      p {
        margin: 0;
        color: $ashy;
      }
    }
    .notice-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      .notice-item {
        padding: 10px 12px;
        border-radius: 8px;
        background-color: $dark;
        border: 1px solid $grey;
        font-size: 14px;
        color: $fg;
      }
    }
  }
  .footer-card {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    align-items: center;
    justify-content: space-between;
    padding: 20px 20px 400px;
    border-radius: 12px;
    background-color: $graphite;
    border: 1px solid $grey;
    box-shadow: 0 12px 24px rgba($black, 0.25);
    animation: liftIn 0.25s ease-out both;
    .footer-text {
      max-width: 600px;
      h2 {
        margin: 0 0 8px;
        font-size: 20px;
      }
      p {
        margin: 0;
        color: $ashy;
      }
      ul {
        margin: 0;
        padding-left: 18px;
        display: grid;
        gap: 6px;
        li {
          color: $fg;
        }
      }
    }
    .footer-meta {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 240px;
      .meta-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
        padding: 8px 10px;
        border-radius: 8px;
        background-color: $graphite;
        border: 1px solid $grey;
        .label {
          font-size: 12px;
          letter-spacing: 1px;
          text-transform: uppercase;
          color: $ashy;
        }
        .value {
          font-size: 14px;
          color: $fg;
        }
      }
    }
  }
}

@keyframes liftIn {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 1280px) {
  .rules {
    .rules-layout {
      grid-template-columns: 1fr;
    }
    .rules-toc {
      display: none;
    }
    .hero {
      grid-template-columns: 1fr;
    }
    .rules-grid {
      grid-template-columns: 1fr;
    }
    .notice {
      grid-template-columns: 1fr;
    }
    .notice-list {
      grid-template-columns: 1fr;
    }
  }
}
</style>
